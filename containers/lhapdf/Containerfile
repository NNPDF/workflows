FROM docker.io/python:3.11

# create a dedicated user
RUN /bin/bash -c "apt update; \
                  apt install -y wget patch autoconf libtool g++ make"

RUN /bin/bash -c "useradd -m me"

USER me
ENV HOME=/home/me
WORKDIR $HOME

RUN /bin/bash -c "pip install numpy"

COPY --chown=me lhapdf $HOME/lhapdf

ENV PREFIX=$HOME/.local
ENV PATH=$PATH:$HOME/.local/bin

RUN /bin/bash -c "cd lhapdf; sh install.sh"

# --------------------------------------------------------- #

FROM docker.io/python:3.11-slim

RUN /bin/bash -c "useradd -m me"

USER me
ENV HOME=/home/me
WORKDIR $HOME

ENV LD_LIBRARY_PATH=$HOME/.local/lib

# COPY --from=0 /usr/lib/x86_64-linux-gnu/libquadmath* /usr/lib/x86_64-linux-gnu/
# COPY --from=0 /usr/lib/x86_64-linux-gnu/libgfortran* /usr/lib/x86_64-linux-gnu/
COPY --from=0 /home/dis/.local/ $HOME/.local
