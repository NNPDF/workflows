FROM docker.io/python:3.10

ARG HOME=/root
ARG PREFIX=$HOME/local

# create a dedicated user
RUN /bin/bash -c "apt update; \
                  apt install -y wget patch autoconf libtool g++ make; \
                  mkdir $HOME/local"

COPY packages/lhapdf $HOME/lhapdf

RUN /bin/bash -c "cd $HOME/lhapdf; sh install.sh"

# --------------------------------------------------------- #

FROM docker.io/python:3.10-slim

# install further packages to support the workflow
# curl: required by snok/install-poetry@v1
# git: required by actions/checkout@v2
# wget: useful to recursively pull remote resources
RUN /bin/bash -c "apt update; \ 
                  apt install -y curl git wget"

COPY --from=0 /root/local/bin/ /usr/local/bin/
COPY --from=0 /root/local/lib/ /usr/local/lib/
COPY --from=0 /root/local/share/ /usr/local/share/

ENV LD_LIBRARY_PATH=/usr/local/lib/
ENV LHAPDF_DATA_PATH=/usr/local/share/LHAPDF/

RUN /bin/bash -c "lhapdf install NNPDF40_nnlo_as_01180 \
                                 ABMP16_5_nnlo \
                                 ATLASpdf21_T1 \
                                 CT18NNLO \
                                 HERAPDF20_NNLO_EIG \
                                 MSHT20nnlo_as118 \
                                 PDF4LHC21_mc"

ENTRYPOINT /bin/bash
